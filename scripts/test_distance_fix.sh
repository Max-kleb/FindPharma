#!/bin/bash
# Script de test pour v√©rifier la correction du bug de distance

echo "=============================================="
echo "üß™ Test de V√©rification - Bug Distance Corrig√©"
echo "=============================================="
echo ""

# Couleurs
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "üìä √âtat des conteneurs:"
podman ps --format "table {{.Names}}\t{{.Status}}" | grep findpharma

echo ""
echo "=============================================="
echo "üåê URLs de l'application:"
echo "=============================================="
echo -e "${GREEN}Frontend:${NC} http://localhost:3000"
echo -e "${GREEN}Backend API:${NC} http://localhost:8000/api"
echo -e "${GREEN}Admin Django:${NC} http://localhost:8000/admin"

echo ""
echo "=============================================="
echo "‚úÖ V√©rifications √† faire manuellement:"
echo "=============================================="
echo ""
echo "1. Ouvrir http://localhost:3000 dans votre navigateur"
echo "2. Se connecter avec un compte utilisateur"
echo "3. Chercher un m√©dicament (ex: 'Parac√©tamol')"
echo "4. V√©rifier les distances affich√©es:"
echo ""
echo -e "   ${RED}‚ùå AVANT (Bug):${NC}"
echo "      - Les distances √©taient affich√©es comme '3 m', '10 m', etc."
echo "      - Beaucoup trop petites (1000x trop petites)"
echo ""
echo -e "   ${GREEN}‚úÖ APR√àS (Corrig√©):${NC}"
echo "      - Les distances doivent maintenant afficher '3.2 km', '10.5 km', etc."
echo "      - Ou '500 m' pour des distances < 1 km"
echo ""
echo "=============================================="
echo "üîç Test avec l'API directement:"
echo "=============================================="
echo ""
echo "Exemple de requ√™te API (Centre-ville Yaound√©):"
echo ""
echo "curl 'http://localhost:8000/api/medicines/search/?q=Paracetamol&latitude=3.8667&longitude=11.5167&max_distance=10' | jq '.results[0].pharmacies[0].distance'"
echo ""
echo "La distance retourn√©e devrait √™tre en KILOM√àTRES (ex: 3.23, pas 3231)"
echo ""
echo "=============================================="
echo "üìù Fichiers modifi√©s:"
echo "=============================================="
echo ""
echo "‚úÖ /frontend/src/services/api.js - Fonction formatDistance() corrig√©e"
echo "‚úÖ /docs/BUG_DISTANCES_TROP_PETITES.md - Documentation compl√®te"
echo "‚úÖ /docs/ORGANISATION_CALCUL_DISTANCE.md - Mise √† jour"
echo ""
echo "=============================================="
echo "üéØ Exemple de ce qui devrait s'afficher:"
echo "=============================================="
echo ""
echo "Pharmacie A - 500 m   ‚úÖ (au lieu de '1 m' ‚ùå)"
echo "Pharmacie B - 1.5 km  ‚úÖ (au lieu de '2 m' ‚ùå)"
echo "Pharmacie C - 3.2 km  ‚úÖ (au lieu de '3 m' ‚ùå)"
echo "Pharmacie D - 10.0 km ‚úÖ (au lieu de '10 m' ‚ùå)"
echo ""
echo "=============================================="
echo "üí° Conseil:"
echo "=============================================="
echo ""
echo "Si les distances semblent encore incorrectes:"
echo "1. Vider le cache du navigateur (Ctrl+Shift+R)"
echo "2. V√©rifier que vous √™tes bien sur http://localhost:3000"
echo "3. Ouvrir la console du navigateur (F12) pour voir les erreurs"
echo ""
echo "=============================================="
echo "‚úÖ Test termin√©!"
echo "=============================================="
